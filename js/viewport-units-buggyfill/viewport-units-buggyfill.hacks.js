(function(root,factory){'use strict';if(typeof define==='function'&&define.amd){define([],factory);}else if(typeof exports==='object'){module.exports=factory();}else{root.viewportUnitsBuggyfillHacks=factory();}}(this,function(){'use strict';var options;var calcExpression=/calc\(/g;var quoteExpression=/[\"\']/g;var urlExpression=/url\([^\)]*\)/g;var isOldInternetExplorer=false;var supportsVminmax=true;var supportsVminmaxCalc=true;/*@cc_on

  @if (@_jscript_version <= 10)
    isOldInternetExplorer = true;
    supportsVminmaxCalc = false;
    supportsVminmax = false;
  @end

  @*/function checkHacks(declarations,rule,name,value){var needsHack=name==='content'&&value.indexOf('viewport-units-buggyfill')>-1;if(!needsHack){return;}var fakeRules=value.replace(quoteExpression,'');fakeRules.split(';').forEach(function(fakeRuleElement){var fakeRule=fakeRuleElement.split(':');if(fakeRule.length!==2){return;}var name=fakeRule[0].trim();if(name==='viewport-units-buggyfill'){return;}var value=fakeRule[1].trim();declarations.push([rule,name,value]);if(calcExpression.test(value)){var webkitValue=value.replace(calcExpression,'-webkit-calc(');declarations.push([rule,name,webkitValue]);}});}return{required:function(options){return options.isMobileSafari||isOldInternetExplorer;},initialize:function(initOptions){options=initOptions;var div=document.createElement('div');div.style.width='1vmax';supportsVminmax=div.style.width!=='';if(options.isMobileSafari||options.isBadStockAndroid){supportsVminmaxCalc=false;}},initializeEvents:function(options,refresh,_refresh){if(options.force){return;}if(isOldInternetExplorer&&!options._listeningToResize){window.addEventListener('resize',_refresh,true);options._listeningToResize=true;}},findDeclarations:function(declarations,rule,name,value){if(name===null){return;}checkHacks(declarations,rule,name,value);},overwriteDeclaration:function(rule,name,_value){if(isOldInternetExplorer&&name==='filter'){_value=_value.replace(/px/g,'');}return _value;}};}));